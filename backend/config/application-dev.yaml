# =============================================================================
# 開發環境行為配置
# =============================================================================
# Profile: dev
# 用途: 本地開發環境，覆蓋正式環境配置：
#   - 啟用 Liquibase（本地啟動時自動遷移）
#   - 停用 OTLP 匯出（本地無 OTel Collector）
#   - DEBUG 日誌、開啟更多 Actuator 端點
# 啟動: spring.profiles.default=local,dev（已在 application.yaml 設定）
# =============================================================================

spring:
  config:
    # 引入本地機敏設定檔（optional: 檔案不存在也不報錯）
    import: "optional:file:./config/application-secrets.properties"

  # ----- Liquibase 配置 -----
  # 本地開發啟動時執行 Liquibase 遷移（正式環境由 Cloud Run Job 執行）
  liquibase:
    enabled: true

  # ----- OAuth2 配置（覆蓋正式環境設定） -----
  # 使用 Mock OAuth2 Server（compose.yaml 中配置）
  security:
    oauth2:
      client:
        registration:
          omnihubs:
            client-id: ${platform-oauth2-client-id}
            client-secret: ${platform-oauth2-client-secret}
            scope: openid,profile
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          omnihubs:
            issuer-uri: ${platform-oauth2-issuer-uri}
      # Resource Server 配置（用於 API JWT 驗證）
      resourceserver:
        jwt:
          issuer-uri: ${platform-oauth2-issuer-uri}

  # ----- 靜態資源開發設定 -----
  # 從原始碼目錄讀取，修改後重整瀏覽器即可
  web:
    resources:
      static-locations: file:src/main/resources/static/
      cache:
        period: 0

# ----- Actuator 配置 -----
# 開發環境開啟更多端點便於除錯
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,configprops
  endpoint:
    health:
      # 開發環境顯示完整健康檢查詳情
      show-details: always
      show-components: always

  # ----- 本地開發停用 OTLP 匯出 -----
  # 本地沒有 OTel Collector，停用避免連線警告
  #
  # Metrics (Micrometer): management.otlp.metrics.export.enabled
  # Logging (OTel SDK):   management.logging.export.otlp.enabled
  # Tracing (OTel SDK):   取樣率設為 0 即不產生 span
  otlp:
    metrics:
      export:
        enabled: false

  # 停用追蹤取樣（不產生 span，不連線 Collector）
  tracing:
    sampling:
      probability: 0.0

  # 停用 OTLP Logging 匯出
  logging:
    export:
      otlp:
        enabled: false

  # 本地環境標記
  opentelemetry:
    resource-attributes:
      deployment.environment: development

# ----- 日誌配置 -----
# 開發環境使用 DEBUG 級別
logging:
  level:
    io.github.samzhu.documentation.platform: DEBUG
    org.springframework.ai: DEBUG
    org.springframework.security: DEBUG

# ----- 功能開關配置 -----
platform:
  features:
    oauth2: true  # 啟用 OAuth2 Stateless 認證流程
                  # 使用 Mock OAuth2 Server (http://localhost:8090)
