# Docker Compose 配置 - 用於本地開發
services:
  pgvector:
    image: 'pgvector/pgvector:pg16'
    environment:
      - 'POSTGRES_DB=mydatabase'
      - 'POSTGRES_PASSWORD=secret'
      - 'POSTGRES_USER=myuser'
    labels:
      - "org.springframework.boot.service-connection=postgres"
    ports:
      - '5432:5432'
    volumes:
      - pgvector_data:/var/lib/postgresql/data

  # Mock OAuth2 Server - 本地開發用 OAuth2/OIDC 測試服務器
  # 參考: https://github.com/navikt/mock-oauth2-server
  # 版本: 3.0.1 (2024-11-03)
  mock-oauth2-server:
    image: ghcr.io/navikt/mock-oauth2-server:3.0.1
    container_name: mock-oauth2
    ports:
      - '8090:8080'
    environment:
      SERVER_PORT: 8080
      LOG_LEVEL: DEBUG
      JSON_CONFIG: |
        {
          "interactiveLogin": true,
          "httpServer": "NettyWrapper",
          "tokenCallbacks": [
            {
              "issuerId": "default",
              "tokenExpiry": 3600,
              "requestMappings": [
                {
                  "requestParam": "grant_type",
                  "match": "authorization_code",
                  "claims": {
                    "aud": ["documentation-platform"],
                    "name": "Test User",
                    "email": "test@example.com",
                    "preferred_username": "testuser",
                    "roles": ["user"]
                  }
                }
              ]
            }
          ]
        }
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/default/isalive"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

volumes:
  pgvector_data:
